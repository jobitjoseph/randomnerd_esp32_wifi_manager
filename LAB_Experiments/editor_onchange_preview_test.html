<!-- 
ACE for ESP8266 ESP32 espasyncwebserver littlefs modifeid LOROL version of FSBrowser https://github.com/lorol/ESPAsyncWebServer
https://www.google.com/search?q=ESP8266+ESP32

button pretty beautify prettyprint format code
autocompletion suggestions  
    
screeenshot autocompletion suggestions
    https://raw.githubusercontent.com/ldijkman/randomnerd_esp32_wifi_manager/main/LAB_Experiments/2022-07-20-205657_1920x1080_scrot.png
   suggestions on / off buttons
     https://raw.githubusercontent.com/ldijkman/randomnerd_esp32_wifi_manager/main/LAB_Experiments/2022-07-20-210618_1920x1080_scrot.png

maybe ctrl+space to activate https://ace.c9.io/demo/autocompletion.html
     
     
Ace 
Ajax.org Cloud9 Editor
Formerly known as Mozilla SkyWriter and forformerly codenamed as BeSpin

for ESP8266 ESP32 espasyncwebserver littlefs modifeid LOROL version of FSBrowser https://github.com/lorol/ESPAsyncWebServer

screenshot image 
https://raw.githubusercontent.com/ldijkman/randomnerd_esp32_wifi_manager/main/LAB_Experiments/2022-07-18-184503_1920x1080_scrot.png

https://github.com/ldijkman/randomnerd_esp32_wifi_manager/blob/main/LAB_Experiments/editor_onchange_preview_test.html

https://ldijkman.github.io/Electra/

save upload or create/copy this file (as *watheveryouwanttonameit* .html)
to your ESP8266 ESP32 espasync webserver LittleFS
will give you an ace js web/cloud editor with live HTML preview
not perfect but it works a bit
added button for opening in new tab
checbox for 50% edit and html peview or 100% edit
checkbox for reload preview on every keystroke or not
button for preview udate if checkbox keystroke is off
colorpicker with button to copy hexvalue
function update on editor textcontent change 
shows only changes after save button is pressed
reload on every key stroke
iframe shows html result
i am not handy with divs
would be nice if the source and preview divs are resizable by mouse drag
maybe a checkbox for preview panel on / off // checkbox for fulscreen eit and  50% edit-preview

would like to have another colorpicker addon in the code editor
https://codepen.io/ldijkman/pen/LYdZpYp
-->


<!DOCTYPE html>
<html lang="en">
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<title>Electra's ESP Editor</title>
<link rel="apple-touch-icon" href="/ace.ico" type="image/x-icon">
<link rel="shortcut icon" href="/ace.ico" type="image/x-icon">
<link rel="icon" href="/ace.ico" type="image/x-icon">
<style type="text/css" media="screen">
  label {
    font-size: 12px;
    font-family: sans-serif
  }

  .cm {
    z-index: 300;
    position: absolute;
    left: 5px;
    border: 1px solid #444;
    background-color: #f5f5f5;
    display: none;
    box-shadow: 0 0 10px rgba(0, 0, 0, .4);
    font-size: 12px;
    font-family: sans-serif;
    font-weight: 700
  }

  .cm ul {
    list-style: none;
    top: 0;
    left: 0;
    margin: 0;
    padding: 0
  }

  .cm li {
    position: relative;
    min-width: 60px;
    cursor: pointer
  }

  .cm span {
    color: #444;
    display: inline-block;
    padding: 6px
  }

  .cm li:hover {
    background: #444
  }

  .cm li:hover span {
    color: #eee
  }

  .tvu li,
  .tvu ul {
    padding: 0;
    margin: 0;
    list-style: none
  }

  .tvu input {
    position: absolute;
    opacity: 0;
  }

  .tvu {
    font: 400 12px Verdana, Arial, Sans-serif;
    -moz-user-select: none;
    -webkit-user-select: none;
    user-select: none;
    color: #444;
    line-height: 16px
  }

  .tvu span {
                  margin-bottom: 5px;
                  padding: 0 0 0 18px;
                  cursor: pointer;
                  display: inline-block;
                  height: 16px;
                  vertical-align: middle;
                  background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAADoSURBVBgZBcExblNBGAbA2ceegTRBuIKOgiihSZNTcC5LUHAihNJR0kGKCDcYJY6D3/77MdOinTvzAgCw8ysThIvn/VojIyMjIyPP+bS1sUQIV2s95pBDDvmbP/mdkft83tpYguZq5Jh/OeaYh+yzy8hTHvNlaxNNczm+la9OTlar1UdA/+C2A4trRCnD3jS8BB1obq2Gk6GU6QbQAS4BUaYSQAf4bhhKKTFdAzrAOwAxEUAH+KEM01SY3gM6wBsEAQB0gJ+maZoC3gI6iPYaAIBJsiRmHU0AALOeFC3aK2cWAACUXe7+AwO0lc9eTHYTAAAAAElFTkSuQmCC) no-repeat;
                  background-position: 0 0;
  }

  .tvu span:hover {
    text-decoration: underline
  }

  @media screen and (-webkit-min-device-pixel-ratio:0) {
    .tvu {
      -webkit-animation: webkit-adjacent-element-selector-bugfix infinite 1s
    }

    @-webkit-keyframes webkit-adjacent-element-selector-bugfix {
      from {
        padding: 0
      }

      to {
        padding: 0
      }
    }
  }

  #uploader {
    position: absolute;
    top: 0;
    right: 0;
    left: 0;
    height: 48px;
    line-height: 24px;
    padding-left: 10px;
    background-color: #444;
    color: #eee
  }

  #tree {
    position: absolute;
    top: 48px;
    bottom: 0;
    left: 0;
    width: 100px;
    padding: 8px
  }

  #editor,
  #preview {
    position: absolute;
    top: 48px;
    right: 0;
    bottom: 0;
    left: 120px;
    border-left: 1px solid #eee
  }

  #preview {
    background-color: #eee;
    padding: 5px
  }

  #loader {
    position: absolute;
    top: 36%;
    right: 40%
  }

  .loader {
    z-index: 10000;
    border: 8px solid #b5b5b5;
    border-top: 8px solid #3498db;
    border-bottom: 8px solid #3498db;
    border-radius: 50%;
    width: 240px;
    height: 240px;
    animation: spin 2s linear infinite;
    display: none
  }

  @keyframes spin {
    0% {
      transform: rotate(0)
    }

    100% {
      transform: rotate(360deg)
    }
  }
</style>

<style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: whitesmoke;
    }

    .p1,
    .header {
      font-size: 32px;
      text-align: center;
    }

    .button {
      text-align: center;
      font-size: 16px;
      justify-content: center;
      align-items: center;
    }

    .p2 {
      text-align: left;
      font-size: 24px;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      ooverflow: hidden;
    }

    #editor {
      height: 95%;
      width: 50%;
      display: inline-block;
      border:1px solid black;
    }

    #container {
      height: 100%;
      width: auto;
      white-space: nowrap;
      ooverflow: hidden;
      position: relative;
    }



    #iframediv {
      float: right;
      margin-top: 48px;
      height: 100%; 
      width: 38%;
      display: inline-block;
      border:1px solid black;

    }
    
#iframe {
 
      top: 48px;
      height: 100%; 
      width: 100%;
      display: inline-block;
  
      
    }
    
    /*
        try to change the selection or highlight searh color
        hard to see the selected in standard setting
    */
    .ace-monokai .ace_marker-layer .ace_selection {
    background: #3399FF4B;
    border: 1px solid #FFFC18FF;
    /*padding-left: 0px;padding-right: 0px;padding-top: 1px;padding-bottom: 1px;*/
}
    .ace_editor .ace_marker-layer .ace_bracket {
      background: #3399FF4B;
    border: 1px solid #FFFC18FF;
    /*padding-left: 0px;padding-right: 0px;padding-top: 1px;padding-bottom: 1px;*/
    }
     .color {
        color: orange;   
      }
      
      .overlay {
  position: fixed;
  top: 0;
  bottom: 0
  left: 0;
  right: 0;
  background: rgba(0, 0, 0, 0.7);
  transition: opacity 500ms;
  visibility: hidden;
  opacity: 0;  
  z-index:99;
}
.overlay:target {
  visibility: visible;
  opacity: 1;
}

.popup {
  margin: 70px auto;
  padding: 20px;
  background: #fff;
  border-radius: 5px;
  width: 30%;
  position: relative;
  transition: all 5s ease-in-out;

}

.popup h2 {
  margin-top: 0;
  color: #333;
  font-family: Tahoma, Arial, sans-serif;
}
.popup .close {
  position: absolute;
  top: 20px;
  right: 30px;
  transition: all 200ms;
  font-size: 30px;
  font-weight: bold;
  text-decoration: none;
  color: #333;
}
.popup .close:hover {
  color: #06D85F;
}
.popup .content {
  max-height: 30%;
  overflow: auto;
}

@media screen and (max-width: 700px){
  .box{
    width: 70%;
  }
  .popup{
    width: 70%;
  }
}
    
    
     .ace_marker-layer .ace_selected-word {
  border: 1px solid #13FF10C1
}
  </style>

<!--
AceEditor ColorPicker AddOn
https://codepen.io/easylogic/pen/RwVOGed
I made a colorpicker for ace editor. #4725
easylogic started this conversation in Ideas
https://github.com/ajaxorg/ace/discussions/4725

-->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ace-colorpicker@0.0.12/addon/ace-colorpicker.css" />
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/ace-colorpicker@0.0.12/addon/ace-colorpicker.min.js" ></script> 

<!--
https://codepen.io/ldijkman/pen/LYdZpYp

button bar colorpicker
-->
  <script type="text/javascript" src="https://jscolor.com/release/2.4/jscolor-2.4.8/jscolor.js" ></script>  

<script>
////////////////////////////////////////////////////////////////////
// luberth => i think next should be here, it is missing in the lorol fsbrowser
https://github.com/lorol/ESPAsyncWebServer/blob/master/examples/ESP_AsyncFSBrowser/data/edit_gz
////////////////////////////////////////////////////////////////////
/*
  FSBrowser - A web-based FileSystem Browser for ESP8266 filesystems
  Copyright (c) 2015 Hristo Gochkov. All rights reserved.
  This file is part of the ESP8266WebServer library for Arduino environment.
  This library is free software; you can redistribute it and/or
  modify it under the terms of the GNU Lesser General Public
  License as published by the Free Software Foundation; either
  version 2.1 of the License, or (at your option) any later version.
  This library is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  Lesser General Public License for more details.
  You should have received a copy of the GNU Lesser General Public
  License along with this library; if not, write to the Free Software
  Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
  See readme.md for more information.
*/
// https://github.com/esp8266/Arduino/tree/master/libraries/ESP8266WebServer/examples/FSBrowser
 
   function loadpick() {  
       console.log("load colorpicker now in function loadpick");
       window.editor = ace.edit("editor");
       AceColorPicker.load(ace,editor);
    }


   function update() {  
     if(document.getElementById("Preview").checked){
        var idoc = document.getElementById('iframe').contentWindow.document;
        idoc.open();
        idoc.write(ace.edit("editor").getValue()); 
        //console.log(ace.edit("editor").getValue());
        idoc.close();
     }
    

    }
    
    function updatefrombutton() {  
        var idoc = document.getElementById('iframe').contentWindow.document;
        idoc.open();
        idoc.write(ace.edit("editor").getValue()); 
        //console.log(ace.edit("editor").getValue());
        idoc.close();
         document.getElementById("save").setAttribute("title", "Save file to ESP LittleFS"); 
    }
    
  function ge(e) {
    return document.getElementById(e)
  }

  function ce(e) {
    return document.createElement(e)
  }

  function sortByKey(e, t) {
    return e.sort((function(e, n) {
      var a = e[t],
        i = n[t];
      return i > a ? -1 : a > i ? 1 : 0
    }))
  }

  function createFileUploader(e, t, n) {
    var a = /(iPhone)*(OS ([7-9]|1[0-1])_)/i.test(navigator.userAgent);

    function i(e, n) {
      200 != e ? alert("ERROR[" + e + "]: " + n) : t.refreshPath(d.value)
    }
    var o = ce("button");
    o.innerHTML = "Root Dir", ge(e).appendChild(o);
    var c = ce("input");
    c.type = "file", c.multiple = !1, c.name = "data", c.id = "upload-select", ge(e).appendChild(c);
    var d = ce("input");
    d.id = "upload-path", d.type = "text", d.name = "path", d.defaultValue = "/", ge(e).appendChild(d);
    var s = ce("button");
    s.innerHTML = "Upload", ge(e).appendChild(s);
    var r = ce("button");
    r.innerHTML = "Create", ge(e).appendChild(r);
    var l = ce("input");
    l.id = "editor-filename", l.type = "text", l.disabled = !0, l.size = 20, ge(e).appendChild(l);
    var u = ce("input");
    u.id = "ipad-fix", u.title="i have no idea what this checkbox does", u.name = "ipad-fix", u.type = "checkbox", u.checked = !!a;
    var p = ce("label");
    p.for = u.id, p.innerHTML = " Alt.";
    var m = ce("button");
    m.innerHTML = " Save ",m.id = "save",m.title="Save file to ESP LittleFS", ge(e).appendChild(m), ge(e).appendChild(p), ge(e).appendChild(u), r.onclick = function(e) {
      (function(e) {
        var t = new FormData;
        t.append("path", e), requests.add("PUT", "/edit", t, i)
      })(d.value), n.loadUrl(d.value), d.value = "/"
    }, m.onclick = function(e) {
      if (u.checked) {
        var t = ace.edit("editor").getValue(),
          a = new FormData;
        a.append("rawname", l.value);
        var o = 0;
        const e = 4096;
        for (var c = 0; c < t.length; c += e) {
          var d = t.substring(c, c + e);
          a.append("raw" + o, d), o++
        }
        requests.add("POST", "/edit", a, i)
      } else n.execCommand("saveCommand")
    }, o.onclick = function(e) {
      t.refreshPath(d.value)
    }, s.onclick = function(e) {
      if (0 !== c.files.length) {
        var t = new FormData;
        t.append("data", c.files[0], d.value), requests.add("POST", "/edit", t, i), ge("upload-path").value = "/", ge("upload-select").value = ""
      }
    }, c.onchange = function(e) {
      if (0 !== c.files.length) {
        var t = c.files[0].name,
          n = /(?:\.([^.]+))?$/.exec(t)[1],
          a = /(.*)\.[^.]+$/.exec(t)[1];
        void 0 !== typeof a && (t = a), d.value = "/" + t + "." + n
      }
    }
    
     
  }

  function createTree(e, t) {
    function n(e) {
      ge("editor-filename").value = e, ge("editor").style.display = "none", 
      p.style.display = "block", p.innerHTML = '<img src="/edit?edit=' + e + "&_cb=" + Date.now() + '" style="max-width:100%; max-height:100%; margin:auto; display:block;" />'
    }

    function a(e, a) {
      var i = ce("ul");
      e.appendChild(i);
      var o = ce("li");
      i.appendChild(o), s(a) ? (o.innerHTML = "<span>Preview</span>", o.onclick = function(t) {
        n(a), document.body.getElementsByClassName("cm").length > 0 && document.body.removeChild(e)
      }) : d(a) && (o.innerHTML = "<span>Edit</span>", o.onclick = function(n) {
        t.loadUrl(a), document.body.getElementsByClassName("cm").length > 0 && document.body.removeChild(e)
      });
      var l = ce("li");
      i.appendChild(l), d(a) || s(a) || function(e) {
        var t = /(?:.([^.]+))?$/.exec(e)[1];
        if (void 0 !== typeof t) switch (t) {
          case "ico":
          case "gz":
          case "zip":
          case "wav":
          case "mp3":
          case "pdf":
            return !0
        }
        return !1
      }(a) ? (l.innerHTML = "<span>Download</span>", l.onclick = function(t) {
        (function(e) {
          ge("download-frame").src = "/edit?download=" + e
        })(a), document.body.getElementsByClassName("cm").length > 0 && document.body.removeChild(e)
      }) : c(a) && (i.appendChild(l), l.innerHTML = "<span>ChDir</span>", l.onclick = function(t) {
        m.removeChild(m.childNodes[0]), u(m, a), document.body.getElementsByClassName("cm").length > 0 && document.body.removeChild(e)
      });
      var p = ce("li");
      i.appendChild(p), p.innerHTML = "<span>Delete</span>", p.onclick = function(t) {
        r(a), document.body.getElementsByClassName("cm").length > 0 && document.body.removeChild(e)
      }
    }

    function i(e, t, n) {
      var i = ce("div"),
        o = document.body.scrollTop ? document.body.scrollTop : document.documentElement.scrollTop,
        c = document.body.scrollLeft ? document.body.scrollLeft : document.documentElement.scrollLeft,
        d = e.clientX + c,
        s = e.clientY + o;
      i.className = "cm", i.style.display = "block", i.style.left = d + "px", i.style.top = s + "px", a(i, t), document.body.appendChild(i);
      var r = i.offsetWidth,
        l = i.offsetHeight;
      i.onmouseout = function(e) {
        (e.clientX < d || e.clientX > d + r || e.clientY < s || e.clientY > s + l) && document.body.getElementsByClassName("cm").length > 0 && document.body.removeChild(i)
      }
    }

    function o(e, a, o) {
      var r = ce("li");
      r.id = a;
      var l = ce("span");
      return l.innerHTML = a, r.appendChild(l), r.onclick = function(e) {
        d(r.id.toLowerCase()) ? t.loadUrl(r.id) : s(r.id.toLowerCase()) ? n(r.id) : c(r.id) && (m.removeChild(m.childNodes[0]) && u(m, r.id.toLowerCase()))
      }, r.oncontextmenu = function(e) {
        e.preventDefault(), e.stopPropagation(), i(e, r.id)
      }, r
    }

    function c(e) {
      return -1 == e.indexOf(".")
    }
    
 

    function d(e) {
      var t = /(?:.([^.]+))?$/.exec(e)[1];
      if (void 0 !== typeof t) switch (t) {
        case "txt":
        case "htm":
        case "html":
        case "js":
        case "css":
        case "xml":
        case "json":
        case "conf":
        case "ini":
        case "h":
        case "c":
        case "cpp":
        case "php":
        case "hex":
        case "ino":
        case "pde":
          return !0
      }
      return !1
    }

    function s(e) {
      var t = /(?:.([^.]+))?$/.exec(e)[1];
      if (void 0 !== typeof t) switch (t) {
        case "png":
        case "jpg":
        case "gif":
        case "bmp":
          return !0
      }
      return !1
    }

    function r(e) {
      var t = new FormData;
      t.append("path", e), requests.add("DELETE", "/edit", t, (function(e, t) {
        200 != e ? alert("ERROR[" + e + "]: " + t) : (m.removeChild(m.childNodes[0]), u(m, "/"))
      }))
    }

    function l(e, t) {
      return function(t, n) {
        200 == t && function(e, t, n) {
          sortByKey(n, "name");
          var a = ce("ul");
          e.appendChild(a);
          for (var i = n.length, c = 0; i > c; c++) "file" === n[c].type && a.appendChild(o(0, n[c].name, n[c].size))
        }(e, 0, JSON.parse(n))
      }
    }

    function u(e, t) {
      requests.add("GET", "/edit", {
        list: t
      }, l(e))
    }
    var p = ge("preview"),
      m = ce("div");
    return m.className = "tvu", ge(e).appendChild(m), this.refreshPath = function(e) {
      m.removeChild(m.childNodes[0]), u(m, "/")
    }, u(m, "/"), this
  }

  function createEditor(e, t, n, a, i) {
    function o(e) {
      var t = "plain",
        n = /(?:.([^.]+))?$/.exec(e)[1];
      if (void 0 !== typeof n) switch (n) {
        case "txt":
        case "hex":
        case "conf":
          t = "plain";
          break;
        case "htm":
          t = "html";
          break;
        case "js":
          t = "javascript";
          break;
        case "h":
        case "c":
        case "cpp":
          t = "c_cpp";
          break;
        case "css":
        case "scss":
        case "php":
        case "html":
        case "json":
        case "xml":
        case "ini":
          t = n
      }
      return t
    }

    function c(e, t) {
      200 != e && alert("ERROR[" + e + "]: " + t)
    }



    function d(e, t) {
      ge("preview").style.display = "none", 
      ge("editor").style.display = "block", 
      200 == e ? s.setValue(t) : s.setValue(""), s.clearSelection()
    }
    void 0 === t && (t = "/schedule.html"), 
    void 0 === n && (n = o(t)), 
    void 0 === a && (a = "monokai"), 
    void 0 === i && (i = "text/" + n, "c_cpp" === n && (i = "text/plain"));
    var s = ace.edit(e);
    return "plain" !== n && 
  
 
   s.session.setMode("ace/mode/"+n, function() {loadpick()}),

    s.setTheme("ace/theme/" + a), 
    s.$blockScrolling = 1 / 0, 
    s.getSession().setUseSoftTabs(!0), 
    s.getSession().setTabSize(2), 
    s.getSession().setUseWorker(!0), 
    s.setHighlightActiveLine(!0), 
    s.setShowPrintMargin(!1), 
    s.getSession().on('change', function() {update()}),
     s.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true
    }),
    s.commands.addCommand({
      name: "saveCommand",
      bindKey: {
        win: "Ctrl-S",
        mac: "Command-S"
      },
      exec: function(e) {
        ! function(e, t, n) {
          var a = new FormData;
          a.append("data", new Blob([t], {
            type: n
          }), e), requests.add("POST", "/edit", a, c)
        }(t, e.getValue() + "", i)
      },
      readOnly: !1
    }), s.commands.addCommand({
      name: "undoCommand",
      bindKey: {
        win: "Ctrl-Z",
        mac: "Command-Z"
      },
      exec: function(e) {
        e.getSession().getUndoManager().undo(!1)
      },
      readOnly: !1
    }), s.commands.addCommand({
      name: "redoCommand",
      bindKey: {
        win: "Ctrl-Shift-Z",
        mac: "Command-Shift-Z"
      },
      exec: function(e) {
        e.getSession().getUndoManager().redo(!1)
      },
      readOnly: !1
    }), s.loadUrl = function(e) {
      ge("editor-filename").value = e, n = o(t = e), i = "text/" + n, "plain" !== n && s.getSession().setMode("ace/mode/" + n),
        function(e) {
          requests.add("GET", "/edit", {
            edit: e
          }, d)
        }(t)
    }, s
  }

  function onBodyLoad() {
    var e = {},
      t = (window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, (function(t, n, a) {
        e[n] = a
      })), createEditor("editor", e.file, e.lang, e.theme)),
      n = createTree("tree", t);
    window.define = ace.define, window.require = ace.require, ace.config.set("basePath", "/"), ace.config.set("workerPath", "/"), createFileUploader("uploader", n, t), void 0 === e.file && (e.file = "/schedule.html"), t.loadUrl(e.file)
  
    ace.require("ace/ext/language_tools");
    
  }
  "undefined" == typeof XMLHttpRequest && (XMLHttpRequest = function() {
    try {
      return new ActiveXObject("Msxml2.XMLHTTP.6.0")
    } catch (e) {}
    try {
      return new ActiveXObject("Msxml2.XMLHTTP.3.0")
    } catch (e) {}
    try {
      return new ActiveXObject("Microsoft.XMLHTTP")
    } catch (e) {}
    throw new Error("This browser does not support XMLHttpRequest.")
  });
  var QueuedRequester = function() {
    this.queue = [], this.running = !1, this.xmlhttp = null
  };
  QueuedRequester.prototype = {
    _request: function(e) {
      if (this.running = !0, !(!e instanceof Object)) {
        var t = this;
        ge("loader").style.display = "block";
        var n = "";
        if (e.params instanceof FormData) n = e.params;
        else if (e.params instanceof Object)
          for (var a in e.params) n += "" === n ? "GET" === e.method ? "?" : "" : "&", n += encodeURIComponent(a) + "=" + encodeURIComponent(e.params[a]);
        this.xmlhttp = new XMLHttpRequest, this.xmlhttp.onreadystatechange = function(e, n) {
          return function() {
            4 == e.readyState && (ge("loader").style.display = "none", n.callback(e.status, e.responseText), 0 === t.queue.length && (t.running = !1), t.running && t._request(t.queue.shift()))
          }
        }(this.xmlhttp, e), "GET" === e.method ? (this.xmlhttp.open(e.method, e.url + n, !0), this.xmlhttp.send()) : (this.xmlhttp.open(e.method, e.url, !0), n instanceof String && this.xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded"), this.xmlhttp.send(n))
      }
    },
    stop: function() {
      this.running && (this.running = !1), this.xmlhttp && this.xmlhttp.readyState < 4 && this.xmlhttp.abort()
    },
    add: function(e, t, n, a) {
      this.queue.push({
        url: t,
        method: e,
        params: n,
        callback: a
      }), this.running || this._request(this.queue.shift())
    }
  };
  var requests = new QueuedRequester
</script>


<!--            https://cdnjs.com/libraries/ace/1.7.0              -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ace.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-language_tools.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/mode-c_cpp.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/snippets/html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/snippets/javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/snippets/css.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-html.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-javascript.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-css.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-searchbox.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/worker-base.min.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-beautify.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-settings_menu.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-keybinding_menu.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.8.0/ext-spellcheck.min.js"></script>

<script>
  if (void 0 === ace.edit) {
    var script = document.createElement("script");
    script.src = "/ace.js", script.async = !1, document.head.appendChild(script)
  }
</script>

<body onload="onBodyLoad()">
 
  


<div id="container">
            

      
      <div id="popup1" class="overlay">
                <div class="popup">
                  <!-- pure CSS popup bit from https://codepen.io/imprakash/pen/GgNMXO -->
                  <a class="close" href="#">&times;</a>
                  <div class="content" style="text-align: left;">
                    <h1>Ace, SkyWriter, BeSpin!</h1>
                    Hellup<br>
                    <br>
                    ctrl+f = find<br>
                    ctrl + s = save <br>
                    ctrl + h = search & replace<br>
                    <br>
                    ctrl + z = undo<br>
                    ctrl + y = redo<br>
                    <br>
                    Find next	Ctrl-K<br>
                    Find previous	Ctrl-Shift-K<br>
                    <br>
                    Change to lower case	Ctrl-Shift-U<br>
                    Change to upper case	Ctrl-U<br>
                    <br>
                    https://divtable.com/generator/<br>
                    <center>
                    <h1>Electra</h1>
                    <a href="https://ldijkman.github.io/Electra/" target="Hey_Electra">https://ldijkman.github.io/Electra/ </a><br>
                    <br>
                    </center>
                  </div>
                </div>
              </div>
      
  
   <div id="loader" class="loader"></div>
    <div id="uploader">
        <div style="float:right;">
          
             <br>
             <!-- https://codepen.io/ldijkman/pen/xxWdBdp -->
             <label>Theme:
<select id="ace-theme" size="1" style="width: 55px;">
  <optgroup label="bright">
    <option value="textmate">textmate</option>
     <option value="chrome">chrome</option>
     <option value="solarized_light">solarized_light</option>
  </optgroup>
  <optgroup label="dark">
    <option value="monokai" selected >monokai</option>
    <option value="twilight">twilight</option>
    <option value="cobalt">cobalt</option>
    <option value="vibrant_ink">vibrant_ink</option>
  </optgroup>
</select>
</label>  

<label>Mode:  
<select id="ace-mode" style="width: 55px;">
  <option value="CSS">CSS</option>
  <option value="HTML" selected>HTML</option>
  <option value="JavaScript">JavaScript</option>
  <option value="JSON">JSON</option>
  <option value="Plain Text">Plain Text</option>
</select>
</label> 


&nbsp;


<script>  
function paste() {  
var myval = document.getElementById("myList").value;  
var htmltext;
//console.log(myval);
if(myval==1){
 //    /* */ or <!-- -->
  
   // test some commands
   // ace.edit("editor").execCommand("toggleBlockComment");
   // editor.execCommand("showKeyboardShortcuts");
  
  //htmltext="<!--     -->";
  //ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
  //console.log(ace.edit("editor").getCursorPosition());
  //console.log(ace.edit("editor").selection.getCursor().column);
  //console.log(ace.edit("editor").selection.getCursor().row);
  //console.log(ace.edit("editor").selection.getCursor().column-6);
  //move cursor rom end of line  inside the comment part of paste
  //ace.edit('editor').gotoLine(ace.edit("editor").selection.getCursor().row+1,ace.edit("editor").selection.getCursor().column-6);
}
if(myval==2){
  htmltext="<!DOCTYPE html>\n<html>\n<head>\n<title>  </title>\n</head>\n<body style=\"background-color: orange; color: yellow;\">\n<center>\n<h1>Hello</h1>\n</center>\n\n</body>\n</html>";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
 
}
if(myval==3){
  htmltext="<img src=\"https://raw.githubusercontent.com/ldijkman/Electra/main/touch_electra.gif\"><br>";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}
if(myval==4){
  htmltext="<a href=\"http://ldijkman.github.io/Electra\" target=\"_blank\">Electra</a><br>";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}
if(myval==5){
  htmltext="<script type=\"text/javascript\" src=\"\"></script\>";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}
if(myval==6){
  htmltext="&nbsp;";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}
if(myval==7){
  htmltext="&emsp;";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}

if(myval==8){
  htmltext="<p align=\"right\">Right align content</p>";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}
if(myval==9){
  htmltext="<iframe id=\"\" align=\"left\" width=\"500\" height=\"320\" src=\"https://www.youtube.com/embed/5uapPPC8eQY?autoplay=1\" style=\"border:none; -ms-transform: scale(1, 1); transform: scale(1, 1)\" scrolling=\"no\"></iframe>";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}
if(myval==10){
  htmltext="<meta http-equiv=\"Refresh\" content=\"10\">\n";
  htmltext+="<!-- does not work nice in preview editor, reloads the page in 10 seconds -->\n";
  htmltext+="<!-- reload to another URL -->\n";
  htmltext+="<!-- <meta http-equiv=\"refresh\" content=\"30; URL=https://ldijkman.github.io/Electra/\"> -->\n";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}
if(myval==11){
  htmltext="<table width=\"100%\" border=\"1\" cellspacing=\"5\" summary=\"bkj\">\n";
  htmltext+="<tr>\n";
	htmltext+="<td style=\"text-align:center;\">1</td>\n";
	htmltext+="<td>2</td>\n";
	htmltext+="<td>3</td>\n";
	htmltext+="</tr>\n";
	htmltext+="<tr>\n";
	htmltext+="<td>4</td>\n";
	htmltext+="<td>5</td>\n";
	htmltext+="<td>6</td>\n";
	htmltext+="</tr>\n";
  htmltext+="</table>\n";
  ace.edit("editor").session.insert(ace.edit("editor").getCursorPosition(), htmltext);
}

ace.edit("editor").focus();
document.getElementById("myList").options[0].selected = true;
}

</script>  
  


<select id = "myList" onchange = "paste()" style="width: 55px;" title="paste at cursor position"> 
<option value="0">paste</option> 
<option value="1" title="comment wil be for html or script"> comment /* */ or &lt;!-- --&gt; Ctrl+Shift+/&nbsp;</option>  
<option value="2" title="paste html example page"> html page </option>  
<option value="3" title="image example"> img src </option>  
<option value="4" title="url text link example"> a href </option>  
<option value="5" title="include script"> script src= </option>  
<option value="6" title="space"> \&\nbsp; </option> 
<option value="7" title="4 spaces"> \&\emsp; </option> 
<option value="8" title="text align right"> p align right </option> 
<option value="9" title="other page in this page example"> iframe </option> 
<option value="10" title="reload page in ?? sec"> meta refresh 10sec</option> 
<option value="11" title="html table example"> html table</option> 
</select>  

&nbsp;

 <input type="button" value="fold" onClick='ace.edit("editor").execCommand("foldAllComments")' title="fold comments">
 <input type="button" value="unfold" onClick='ace.edit("editor").execCommand("unfoldall")' title="unfoldall comments">
  
<button onclick='pretty()' id="pretty" title="beatify pretty print format ">pretty</button>&nbsp;
          

            <button onclick='suggestonoff()' id="butsuggest" title="suggest on / off">suggest</button>&nbsp;&nbsp;
          
           
           
              <button onclick='ace.edit("editor").setFontSize(ace.edit("editor").getFontSize()-1);' title="zoom -">-</button>&nbsp;&nbsp;
             <button onclick='ace.edit("editor").setFontSize(ace.edit("editor").getFontSize()+1);' title="zoom +">+</button>&nbsp;&nbsp;&nbsp;&nbsp;
             
             <!--  https://codepen.io/jackliangtw/pen/yLVPQNB   -->
             <button onclick="toggleFullScreen()" title="Toggle FullScreen">FullScreen</button>&nbsp;&nbsp;&nbsp;&nbsp;
             
             <input type="button" value="Undo" onClick='ace.edit("editor").execCommand("undo");' title="undo">
             <input type="button" value="Redo" onClick='ace.edit("editor").execCommand("redo");' title="redo">&nbsp;&nbsp;&nbsp;&nbsp;
             
             <input type="button" value="Search" onClick='ace.edit("editor").execCommand("find");' title="search">
             <input type="button" value="Replace" onClick='ace.edit("editor").execCommand("replace");' title="search and replace">&nbsp;&nbsp;&nbsp;&nbsp;
             
             <button id="webbutton" title="view in browser window (note: you have to save to see changes)">www</button>
             <input type="checkbox" class="fulledit" id ="fulledit" name="fulledit" title="full edit screen" checked>
             <input type="checkbox" class="Preview" id ="Preview" name="Preview" title="reload preview on every keystroke on/off" checked>
             <input type="button" value="Preview" onClick="updatefrombutton();" title="reload by button if checkbox is off" ></label>&nbsp;&nbsp;&nbsp;
             Color: <input id="to-select-text" style="width:60px;" onClick="this.select();" value="#3399FF80" data-jscolor="{}" title="colorpicker" >
             <button id="copy-button" title="maybe copy works" >Copy</button>
             
             <input type="button" value="Set" onClick='ace.edit("editor").execCommand("showSettingsMenu");' title="show settings menu">
             <button id="info-button"  onClick="location.href='#popup1'"><b>?</b></button>&nbsp;
        </div>
    </div>

    <div id="tree"></div>
 
    <div id="editor"></div>
    
    <div id="iframediv"><iframe id="iframe" frameborder="0"></iframe></div>
  
    <div id="preview" style="display:none"></div>
    
    <iframe id="download-frame" style="display:none"></iframe>

</div>








<script>


am = document.getElementById('ace-mode');
am.addEventListener('change', function(e) {
  console.log((document.getElementById('ace-mode').value).toLowerCase());
  e.preventDefault();
 ace.edit("editor").getSession().setMode('ace/mode/' + (document.getElementById('ace-mode').value).toLowerCase());
});

at = document.getElementById('ace-theme');
at.addEventListener('change', function(e) {
  console.log((document.getElementById('ace-theme').value).toLowerCase());
  e.preventDefault();
 ace.edit("editor").setTheme('ace/theme/' + (document.getElementById('ace-theme').value).toLowerCase());
});





////////////// open filename in a new browser windoww /////////////////////////////////////////////
www = document.getElementById('webbutton');

www.addEventListener('click', function(e) {
  e.preventDefault();
  //window.open( document.getElementById('editor-filename').value;, '_blank')"
  
  window.open("."+document.getElementById('editor-filename').value+"");
  //alert(document.getElementById('editor-filename').value);
  //alert(document.body.style.zoom).text;
});




///////////////// checkbox editor 505 100% toggle /////////////////////////////////////////////////
checkbox = document.getElementById('fulledit');

checkbox.addEventListener('change', e => {

    if(e.target.checked){
        document.getElementById('editor').style.width = '50%';
    }
    if(!e.target.checked){
         document.getElementById("Preview").checked=false;
         document.getElementById('editor').style.width = '100%';
    }

});




/////////////// copy color hex value to clipboard shoud work on http:// connection /////////////////////////////
// https://codepen.io/fabean/pen/GprQJa
// https://codepen.io/ldijkman/pen/VwXPrWo
let button = document.getElementById('copy-button');

button.addEventListener('click', function(e) {
  e.preventDefault();
  document.execCommand('copy', false, document.getElementById('to-select-text').select());
});



/*
Code Source來源:
https://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API
https://codepen.io/jackliangtw/pen/yLVPQNB
*/

//document.addEventListener("keypress", function(e) {
  //if (e.keyCode === 13) {
  //  toggleFullScreen();
  //}
//}, false);

function toggleFullScreen() {
  if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
  } else {
    if (document.exitFullscreen) {
      document.exitFullscreen();
    }
  }
  
}

// https://ldijkman.github.io/Electra/  

function suggestonoff(){  // toggle autocomplete suggest button
  if(ace.edit("editor").getOption("enableLiveAutocompletion")==true){
    ace.edit("editor").setOptions({enableLiveAutocompletion: false});
    document.getElementById("butsuggest").style="background-color:#FFDACAFF;"  //redisch
  }else{
    ace.edit("editor").setOptions({enableLiveAutocompletion: true});
    document.getElementById("butsuggest").style="background-color:#CAFFC8FF;"   //greenisch
  }
  console.log(ace.edit("editor").getOption("enableLiveAutocompletion"));
}



  if(ace.edit("editor").getOption("enableLiveAutocompletion")==true){
    ace.edit("editor").setOptions({enableLiveAutocompletion: false});
    document.getElementById("butsuggest").style="background-color:#FFDACAFF;"  //redisch
  }else{
    ace.edit("editor").setOptions({enableLiveAutocompletion: true});
    document.getElementById("butsuggest").style="background-color:#CAFFC8FF;"   //greenisch
  }
  
  function pretty(){
    var beautify = ace.require("ace/ext/beautify"); // get reference to extension
    var editor = ace.edit("editor"); // get reference to editor
    beautify.beautify(editor.session);
  }
  
  
  document.onreadystatechange = function() {
        if (document.readyState !== "complete") {
          
         
          
              if(ace.edit("editor").getOption("enableLiveAutocompletion")==false){
                document.getElementById("butsuggest").style="background-color:#FFDACAFF;"  //redisch
              }else{
                document.getElementById("butsuggest").style="background-color:#CAFFC8FF;"   //greenisch
              }
        } 
    };
  
</script>
 
 
<!-- 
https://ldijkman.github.io/Electra/ 
Copyright Electra 2022
-->


